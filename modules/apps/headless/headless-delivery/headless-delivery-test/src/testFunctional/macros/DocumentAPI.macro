definition {

	macro _addDocument {
		Variables.assertDefined(parameterList = ${filePath});

		var portalURL = JSONCompany.getPortalURL();

		if (isSet(depotName)) {
			var assetLibraryId = JSONGroupAPI._getDepotIdByName(depotName = ${depotName});

			var api = "asset-libraries/${assetLibraryId}/documents";
		}
		else {
			var api = "sites/${siteId}/documents";
		}

		if (!(isSet(externalReferenceCode))) {
			var externalReferenceCode = "";
		}

		var curl = '''
			${portalURL}/o/headless-delivery/v1.0/${api} \
				-u test@liferay.com:test \
				-H Content-Type: multipart/form-data \
				-F document={"externalReferenceCode": "${externalReferenceCode}"} \
				-F file=@${filePath}
		''';

		var curl = JSONCurlUtil.post(${curl});

		return ${curl};
	}

	macro _deleteDocumentsByErcInAssetLibrary {
		Variables.assertDefined(parameterList = ${externalReferenceCode});

		var portalURL = JSONCompany.getPortalURL();

		if (isSet(depotName)) {
			var assetLibraryId = JSONGroupAPI._getDepotIdByName(depotName = ${depotName});

			var api = "asset-libraries/${assetLibraryId}/documents/by-external-reference-code/${externalReferenceCode}";
		}
		else {
			var api = "sites/${siteId}/documents/by-external-reference-code/${externalReferenceCode}";
		}

		var curl = '''
			${portalURL}/o/headless-delivery/v1.0/${api} \
				-u test@liferay.com:test \
				-H accept: application/json
		''';

		var curl = JSONCurlUtil.delete(${curl});

		return ${curl};
	}

	macro _filterDocumentInAssetLibrary {
		Variables.assertDefined(parameterList = "${depotName},${filtervalue}");

		var assetLibraryId = JSONGroupAPI._getDepotIdByName(depotName = ${depotName});
		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/o/headless-delivery/v1.0/asset-libraries/${assetLibraryId}/documents?filter=${filtervalue} \
				-u test@liferay.com:test \
				-H accept: application/json
		''';

		var curl = JSONCurlUtil.get(${curl});

		return ${curl};
	}

	macro _getDocumentsByDifferentParameters {
		Variables.assertDefined(parameterList = ${documentId});

		var portalURL = JSONCompany.getPortalURL();

		if (isSet(parameter)) {
			var api = "documents/${documentId}?${parameter}=${parameterValue}";
		}
		else {
			var api = "documents/${documentId}";
		}

		var curl = '''
			${portalURL}/o/headless-delivery/v1.0/${api} \
				-u test@liferay.com:test \
				-H Content-Type: application/json
		''';

		var curl = JSONCurlUtil.get(${curl});

		return ${curl};
	}

	macro _getDocumentsByErcInAssetLibrary {
		Variables.assertDefined(parameterList = ${externalReferenceCode});

		var portalURL = JSONCompany.getPortalURL();

		if (!(isSet(assetLibraryId))) {
			var assetLibraryId = JSONGroupAPI._getDepotIdByName(depotName = ${depotName});
		}

		var curl = '''
			${portalURL}/o/headless-delivery/v1.0/asset-libraries/${assetLibraryId}/documents/by-external-reference-code/${externalReferenceCode} \
				-u test@liferay.com:test \
				-H Content-Type: application/json
		''';

		var curl = JSONCurlUtil.get(${curl});

		return ${curl};
	}

	macro _updateDocumentByErc {
		Variables.assertDefined(parameterList = ${externalReferenceCode});

		if (!(isSet(filePath) || isSet(title) || isSet(updateExternalReferenceCode))) {
			TestUtils.fail(message = "Please set at least one property to update the document.");
		}

		if (isSet(depotName)) {
			var assetLibraryId = JSONGroupAPI._getDepotIdByName(depotName = ${depotName});

			var api = "asset-libraries/${assetLibraryId}/documents/by-external-reference-code/${externalReferenceCode}";
		}
		else {
			var api = "asset-libraries/${siteId}/documents/by-external-reference-code/${externalReferenceCode}";
		}

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/o/headless-delivery/v1.0/${api} \
				-u test@liferay.com:test \
		''';
		var delimiter = " ";

		if (isSet(filePath)) {
			var fileBody = "-F file=@\"${filePath}\"";

			var curl = StringUtil.add(${curl}, ${fileBody}, ${delimiter});
		}

		if (isSet(title) && isSet(updateExternalReferenceCode)) {
			var documentBody = '''
				-F document={"externalReferenceCode": "${updateExternalReferenceCode}", "title": "${title}"}
			''';

			var curl = StringUtil.add(${curl}, ${documentBody}, ${delimiter});
		}
		else {
			if (isSet(title)) {
				var documentBody = '''
					-F document={"title": "${title}"}
				 ''';
			}
			else if (isSet(updateExternalReferenceCode)) {
				var documentBody = '''
					-F document={"externalReferenceCode": "${updateExternalReferenceCode}"}
				''';
			}

			var curl = StringUtil.add(${curl}, ${documentBody}, ${delimiter});
		}

		var curl = JSONCurlUtil.put(${curl});

		return ${curl};
	}

	macro addDocumentInAssetLibraryByUploadFile {
		Variables.assertDefined(parameterList = "${depotName},${filePath}");

		var response = DocumentAPI._addDocument(
			depotName = ${depotName},
			externalReferenceCode = ${externalReferenceCode},
			filePath = ${filePath});

		return ${response};
	}

	macro assertExternalReferenceCodeWithCorrectValue {
		if (!(isSet(expectedExternalReferenceCodeValue))) {
			var expectedExternalReferenceCodeValue = DocumentAPI.getUuidOfCreatedDocument(responseToParse = ${responseToParse});
		}

		var actualExternalReferenceCodeValue = JSONUtil.getWithJSONPath(${responseToParse}, "$..externalReferenceCode");

		TestUtils.assertEquals(
			actual = ${actualExternalReferenceCodeValue},
			expected = ${expectedExternalReferenceCodeValue});
	}

	macro assertProperDocumentTotalCount {
		Variables.assertDefined(parameterList = ${expectedDocumentTotalCount});

		var response = DocumentAPI._filterDocumentInAssetLibrary(
			depotName = ${depotName},
			filtervalue = ${filtervalue});

		var actualDocumentTotalCount = JSONUtil.getWithJSONPath(${response}, "$..['totalCount']");

		TestUtils.assertEquals(
			actual = ${actualDocumentTotalCount},
			expected = ${expectedDocumentTotalCount});
	}

	macro deleteDocumentInAssetLibrary {
		Variables.assertDefined(parameterList = ${depotName});

		if (!(isSet(externalReferenceCode))) {
			Variables.assertDefined(parameterList = ${responseToParse});

			var externalReferenceCode = DocumentAPI.getUuidOfCreatedDocument(responseToParse = ${responseToParse});
		}

		DocumentAPI._deleteDocumentsByErcInAssetLibrary(
			depotName = ${depotName},
			externalReferenceCode = ${externalReferenceCode});
	}

	macro getDocumentsByDifferentParameters {
		var response = DocumentAPI._getDocumentsByDifferentParameters(
			documentId = ${documentId},
			parameter = ${parameter},
			parameterValue = ${parameterValue});

		return ${response};
	}

	macro getDocumentsByErcInAssetLibrary {
		var response = DocumentAPI._getDocumentsByErcInAssetLibrary(
			assetLibraryId = ${assetLibraryId},
			depotName = ${depotName},
			externalReferenceCode = ${externalReferenceCode});

		return ${response};
	}

	macro getIdOfCreatedDocument {
		var response = DocumentAPI.addDocumentInAssetLibraryByUploadFile(
			depotName = ${depotName},
			externalReferenceCode = ${externalReferenceCode},
			filePath = ${filePath});

		var documentId = JSONPathUtil.getIdValue(response = ${response});

		return ${documentId};
	}

	macro getTitleOfDocument {
		var documentTitle = JSONUtil.getWithJSONPath(${responseToParse}, "$.['title']");

		return ${documentTitle};
	}

	macro getUuidOfCreatedDocument {
		Variables.assertDefined(parameterList = ${responseToParse});

		var contentURL = JSONUtil.getWithJSONPath(${responseToParse}, "$.['contentUrl']");

		var contentURLSubString = StringUtil.extractFirst(${contentURL}, "?");

		var documentUuid = StringUtil.extractLast(${contentURLSubString}, "/");

		return ${documentUuid};
	}

	macro updateDocumentByErcInAssetLibrary {
		Variables.assertDefined(parameterList = ${depotName});

		var response = DocumentAPI._updateDocumentByErc(
			depotName = ${depotName},
			externalReferenceCode = ${externalReferenceCode},
			filePath = ${filePath},
			title = ${title},
			updateExternalReferenceCode = ${updateExternalReferenceCode});

		return ${response};
	}

}